<!--
---
toc:
  auto: false
  label: (Informative) Diagnosing results in generated files
  enumerate: Appendix H.
---
-->
# (Informative) Diagnosing results in generated files

Sometimes it is desirable to analyze files generated by the build. These files are usually not under source control, and the build might even overwrite them multiple times. This Appendix offers guidance on how to persist enough information in a SARIF log file to facilitate the diagnosis of results in these files.

In what follows, we will refer to files that are generated only once as "singly generated," and files that are generated multiple times as "multiply generated."

It can be difficult to diagnose results in generated files for the following reasons:

- The file might not be available to the engineer who diagnoses the result (for example, the engineer might not have a build environment).

- If the file is multiply generated, then at best only the last version is available, but results might have been found in previous versions.

- It might be difficult to tell which instance of a multiply generated file contained the result.

For both singly and multiply generated files, there are two options (which can be used together):

1.  Use the `physicalLocation` object’s ([sec](#physicallocation-object)) `region` ([sec](#region-property)) and `contextRegion` ([sec](#contextregion-property)) properties to store enough of the generated file’s contents to facilitate diagnosis. The `region` object’s ([sec](#region-object)) `snippet` property ([sec](#snippet-property)) holds the relevant portion of the file contents.

2.  Use the `artifact` object’s ([sec](#artifact-object)) `contents` ([sec](#artifact-object--contents-property)) property to persist the entire contents of the file in `theRun.artifacts` ([sec](#artifacts-property)).

The first option is more compact; the second allows a SARIF viewer to present results with greater context.

> EXAMPLE 1: In this example, the analysis tool populates `region.snippet` and `contextRegion.snippet`, allowing a SARIF viewer to display just enough context (one hopes) to diagnose the result.
>
> ```json
> {                                           # A run object ((#run-object)).
>   "originalUriBaseIds": {                   # See (#run-object).14
>     "GENERATED": {
>       "uri": "file:///C:/code/browser/obj/"
>     }
>   },
> 
>   "results": [                              # See (#results-property).
>     {                                       # A result object ((#result-object)).
>       "ruleId": "CS6789",                   # See (#ruleid-property).
>       "message": {                          # See (#result-object--message-property).
>         "text": "Division by 0"
>       },
>       "locations": [                        # See (#result-object--locations-property).
>         {                                   # A location object ((#location-object)).
>           "physicalLocation": {             # See (#physicallocation-property).
>             "artifactLocation": {
>               "uri": "ui/window.g.cs",      # A generated file (".g").
>               "uriBaseId": "GENERATED"
>             },
>             "region": {
>               "startLine": 42,
>               "snippet": {
>                 "text": "    int z = x / y;\r\n"
>               }
>             },
>             "contextRegion": {
>               "startLine": 40,
>               "endLine": 42,
>               "snippet": {
>                 "text":
>                  "    int x = 54;\r\n    int y = 0;\r\n    int z = x / y;\r\n"
>               }
>             }
>           }
>         }
>       ]
>     }
>   ],
> 
>   ...
> }
> ```

> EXAMPLE 2: In this example, the analysis tool populates `artifact.contents`, allowing a SARIF viewer to present the result in a larger context at the expense of a larger log file.
>
> ```json
> {
>   "originalUriBaseIds": {
>     "GENERATED": {
>       "uri": "file:///dev-1.example.com/code/browser/obj/"
>     }
>   },
> 
>   "results": [
>     {
>       "ruleId": "CS6789",
>       "message": {
>         "text": "Division by 0"
>       },
>       "locations": [
>         {
>           "physicalLocation": {
>             "artifactLocation": {
>               "uri": "ui/window.g.cs",
>               "uriBaseId": "GENERATED",
>               "index": 0
>             },
>             "region": {
>               "startLine": 42
>             },
>             "contextRegion": {
>               "startLine": 40,
>               "endLine": 42
>             }
>           }
>         }
>       ]
>     }
>   ],
> 
>   "artifacts": [                            # See (#artifacts-property).
>     {                                       # An artifact object ((#artifact-object)).
>       "location": {                         # See (#artifact-object--location-property).
>         "uri": "ui/window.g.cs",
>         "uriBaseId": "GENERATED"
>       },
>       "contents": {                         # See (#artifact-object--contents-property).
>         "text": "..."                       # See (#artifactcontent-object--text-property).
>       }
>     }
>   ]
> }
> ```

Multiply generated files are treated similarly, but they present an additional problem: if more than one version of a given multiply generated file appears in `theRun.artifacts` – either because the analysis tool wishes to persist the file contents, or for any other reason – then there must be a way to distinguish them.

The recommended solution is for the analysis tool to create a new entry in `theRun.artifacts` for each version of the generated files. The result might look like the following example.

> EXAMPLE 3: In this example, `"ui/window.g.cs"` is multiply generated. The analysis tool creates distinct entries in `theRun.artifacts` to distinguish the two versions.
>
> ```json
> {
>   "originalUriBaseIds": {
>     "GENERATED": {
>       "uri": "file:///dev-1.example.com/code/browser/obj/"
>     }
>   },
> 
>   "results": [
>     {
>       "ruleId": "CS6789",
>       "message": {
>         "text": "Division by 0"
>       },
>       "locations": [
>         {
>           "physicalLocation": {
>             "artifactLocation": {
>               "uri": "ui/window.g.cs",
>               "uriBaseId": "GENERATED",
>               "index": 0                  # Points to the appropriate instance
>             },                            #  of the generated file.
>             "region": {
>               "startLine": 42
>             },
>             "contextRegion": {
>               "startLine": 40,
>               "endLine": 42
>             }
>           }
>         }
>       ]
>     }
>   ],
> 
>   "artifacts": [
>     {
>       "location": {
>         "uri": "ui/window.g.cs",
>         "uriBaseId": "GENERATED"
>       },
>       "lastModifiedTimeUtc": "2019-04-13T11:45:23.477",
>       "contents": {
>         "text": "..."
>       }
>     },
> 
>     {
>       "location": {
>         "uri": "ui/window.g.cs",
>         "uriBaseId": "GENERATED"
>       },
>       "lastModifiedTimeUtc": "2019-04-13T11:46:27.013",
>       "contents": {
>         "text": "..."
>       }
>     }
>   ]
> }
> ```
